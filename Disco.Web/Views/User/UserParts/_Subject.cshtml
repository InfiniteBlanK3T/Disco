@model Disco.Web.Models.User.ShowModel
<table id="User_Show_Subjects">
    <tr>
        <td id="User_Show_Details">
            <div>
                <div id="User_Show_Details_Identity">
                    <table class="none verticalHeadings">
                        <tr>
                            <td><span>Username (Id):</span>
                            </td>
                            <td>
                                <h4 id="User_Show_Details_Identity_Id" title="Username">@Model.User.Id</h4>
                            </td>
                        </tr>
                        <tr>
                            <td>Display Name:</td>
                            <td><span id="User_Show_Details_Identity_DisplayName" title="Display Name">@Model.User.DisplayName</span></td>
                        </tr>
                        <tr>
                            <td>Given Name:</td>
                            <td><span id="User_Show_Details_Identity_GivenName" title="Given Name">@Model.User.GivenName</span></td>
                        </tr>
                        <tr>
                            <td>Surname:</td>
                            <td><span id="User_Show_Details_Identity_Surname" title="Surname">@Model.User.Surname</span></td>
                        </tr>
                    </table>
                </div>
                <div id="User_Show_Details_Category" class="status">
                    <table class="none verticalHeadings">
                        <tr>
                            <td>Type:
                            </td>
                            <td><span id="User_Show_Details_Category_Type" title="Type">@Model.User.Type</span></td>
                        </tr>
                    </table>
                </div>
                <div id="User_Show_Details_Attributes" class="status">
                    <table class="none verticalHeadings">
                        <tr>
                            <td>Email:</td>
                            <td>
                                @if (!string.IsNullOrEmpty(Model.User.EmailAddress))
                                {
                                    <span id="User_Show_Details_Attributes_Email" title="Email Address [Update in Active Directory]">@Model.User.EmailAddress</span>
                                }
                                else
                                {
                                    <span class="smallMessage">Unknown</span>
                                }
                            </td>
                        </tr>
                        <tr>
                            <td>Phone:</td>
                            <td>
                                @if (!string.IsNullOrEmpty(Model.User.PhoneNumber))
                                {
                                    <span id="User_Show_Details_Attributes_Phone" title="Phone Number [Update in Active Directory]">@Model.User.PhoneNumber</span>
                                }
                                else
                                {
                                    <span class="smallMessage">Unknown</span>
                                }
                            </td>
                        </tr>
                    </table>
                </div>
                <div id="User_Show_GenerateDocument_Container" class="status">
                    @Html.DropDownList("User_Show_GenerateDocument", Model.DocumentTemplatesSelectListItems)
                    <script type="text/javascript">
                        $(function () {
                            var generatePdfUrl = '@Url.Action(MVC.API.User.GeneratePdf(Model.User.Id, null))?DocumentTemplateId=';
                            var $documentTemplates = $('#User_Show_GenerateDocument');
                            $documentTemplates.change(function () {
                                var v = $documentTemplates.val();
                                if (v) {
                                    window.location.href = generatePdfUrl + v;
                                    $documentTemplates.val('').blur();
                                }
                            });
                        });
                    </script>
                </div>
                <div id="User_Show_Details_Actions">
                    @{
                        Html.BundleDeferred("~/ClientScripts/Modules/Disco-CreateJob");
                    }
                    @Html.ActionLinkSmallButton("Create Job", MVC.Job.Create(Model.PrimaryDeviceSerialNumber, Model.User.Id), "buttonCreateJob")
                </div>
            </div>
        </td>
        <td id="User_Show_AssignedDevices">
            <div>
                <div id="User_Show_AssignedDevices_Active">
                    <h3>Current Device Assignments</h3>
                    @{
                        var currentAssignments = Model.User.DeviceUserAssignments.Where(dua => !dua.UnassignedDate.HasValue).ToList();
                    }
                    @if (currentAssignments.Count > 0)
                    {
                        foreach (var assignment in currentAssignments)
                        {
                        <div class="User_Show_AssignedDevices_CurrentAssignment clearfix" data-deviceserialnumber="@assignment.DeviceSerialNumber">
                            <a href="@Url.Action(MVC.Device.Show(assignment.Device.SerialNumber))">
                                <img class="User_Show_AssignedDevices_CurrentAssignment_Image" alt="Model Image" src="@Url.Action(MVC.API.DeviceModel.Image(assignment.Device.DeviceModel.Id, assignment.Device.DeviceModel.ImageHash()))" />
                            </a>
                            <div class="User_Show_AssignedDevices_CurrentAssignment_Details">
                                <table class="none">
                                    <tbody>
                                        <tr>
                                            <td>Serial Number:
                                            </td>
                                            <td>
                                                <span class="User_Show_AssignedDevices_CurrentAssignment_SerialNumber">@Html.ActionLink(assignment.Device.SerialNumber, MVC.Device.Show(assignment.Device.SerialNumber))</span> (<span>@assignment.Device.ComputerName</span>)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Model:
                                            </td>
                                            <td>
                                                <span class="User_Show_AssignedDevices_CurrentAssignment_Model">@assignment.Device.DeviceModel.ToString()</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Asset:</td>
                                            <td>
                                                @if (!string.IsNullOrEmpty(assignment.Device.AssetNumber))
                                                {
                                                    <span class="User_Show_AssignedDevices_CurrentAssignment_Asset">@assignment.Device.AssetNumber</span>
                                                }
                                                else
                                                {
                                                    <span class="smallMessage">Unknown</span>
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Assigned:</td>
                                            <td>
                                                <span class="User_Show_AssignedDevices_CurrentAssignment_Assigned">@CommonHelpers.FriendlyDate(assignment.AssignedDate)</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>   
                        }
                    }
                    else
                    {
                        <span class="smallMessage">No Current Device Assignments</span>
                    }
                </div>
            </div>
        </td>
    </tr>
</table>
